<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Loops and conditional statements</title>
    <meta charset="utf-8" />
    <meta name="author" content="Lars Relund Nielsen" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="libs/slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Loops and conditional statements
]
.author[
### Lars Relund Nielsen
]

---







layout: true

<div class="my-footer">
<span>
<a href="https://bss-osca.github.io/tfa/mod-vba-loops-cond" target="_blank">Notes</a>
 | 
<a href="03_vba-loops-cond-slides.html" target="_blank">Slides</a>
 | 
<a href="https://github.com/bss-osca/tfa/blob/master/slides/03_vba-loops-cond-slides.Rmd" target="_blank">Source</a>
 | 
<a href="https://github.com/bss-osca/tfa/blob/master/vba/03-vba-loops-cond-template.xlsm" target="_blank">Excel file</a>
</span>
</div>

---

## Relational (comparison) operators 

&lt;table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;border-bottom: 0;"&gt;
&lt;caption&gt;Comparison/relational operators.&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Operator &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Description &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Example &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; = &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Equal to. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A = B ' False &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &amp;lt;&amp;gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Not equal to &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &amp;lt;&amp;gt; B ' True &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Greater than. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &amp;gt; B ' False &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &amp;lt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Less than. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &amp;lt; B ' True &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;= &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Greater than or equal to. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &amp;gt;= B ' False &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; &amp;lt;= &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Less than or equal to. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A &amp;lt;= B ' True &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; Assume that A = 2 and B=4.&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
 
---

## Logical operators 

&lt;table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;border-bottom: 0;"&gt;
&lt;caption&gt;Logical operators.&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Operator &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Description &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Example &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; AND &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; If both the conditions are True, then the expression is true. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A&amp;lt;&amp;gt;0 AND B&amp;lt;&amp;gt;0 ' False &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; OR &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; If any of the two conditions are True, then the expression is true. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A&amp;lt;&amp;gt;0 OR B&amp;lt;&amp;gt;0 ' True &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; NOT &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Reverse logical: if the expression is true, then the NOT operator returns false. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NOT(A&amp;lt;&amp;gt;0 OR B&amp;lt;&amp;gt;0) ' False &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; XOR &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Logical Exclusion. If exactly one condition is True, the result is True. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; A&amp;lt;&amp;gt;0 XOR B&amp;lt;&amp;gt;0 ' True &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; Assume that A = 0 and B=4.&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;

---

## Conditional statements

Used to redirect code execution based on the conditions. If the condition is met then the code is executed. The general layout of an if-then-else conditional statement is: 

An if then statement:

   ```
   If &lt;condition&gt; Then
    &lt;code&gt;
   ElseIf &lt;condition&gt; Then
    &lt;code&gt;
   ElseIf &lt;condition&gt; Then
    &lt;code&gt;
   Else
    &lt;code&gt;
   End If
   
   If &lt;condition&gt; Then &lt;code&gt; Else &lt;code&gt;  ' single line form
   ```

You can drop the `ElseIf` and `Else` code chunks. Let us try to look at procedure `TM3_Comparison` and `TM3_Logical` in the Excel file

---

## Loops

Loops are used to repeat pieces of code. We will consider
- For loops (repeat a number of times):
      ```
      For i = 1 To 10 
          &lt;code&gt;
      Next
      ```
- While loops (repeat until a condition is met):
      ```
      Do While &lt;condition true&gt;    
          &lt;code&gt;
      Loop
      ```
- Other loops exists but in general you can always use for or while loops instead.
- Use `Exit for` and `Exit Do` to break a `For` and a `Do While` loop before it ends (jump to the code after the for loop).

---

## Nested loops

Loops may be nested inside each other. For instance if some action needs to be performed for each day and each employee or for each project and each work package of that project.
```
Sub NestedLoops()
    Dim i As Integer, j As Integer
    For i = 1 To 2      ' days
        For j = 1 To 3  ' employees 
            MsgBox ("(" &amp; i &amp; "," &amp; j &amp; ")")
        Next
    Next
End Sub
```

---

## Beware of endless loops

.pull-left[
If the stopping criteria is NOT reached when using a while loop, the computer will keep going ... 

- Always “save” before “run”
- Make sure the stopping criterion will be reached.
- On Windows you may try to stop the program using Ctrl + Break or Ctrl + Alt + Delete.
- On a mac you may try ⌘ + ., ⌃ +  Esc or  ⌘⌥ + Esc.
]

.pull-right[
&lt;img src="./img/loop.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## The `For Each` loop

The loop is used for running trough a set of objects (we will have a closer look at objects next week)

```
Sub TM3_ForEach()
   Dim rngC As Range
   Dim i As Integer
   
   Worksheets("TM3").Activate
   i = 1
   For Each rngC In Range("D6:E9")
      rngC = i
      i = i + 1
   Next
End Sub
```

Here `rngC` is used to run through all the cells in the range and set values.

---

## Examples

In module `TM3_ex` there are examples using conditional statements and loops:

- Separate persons into groups.
- Find Jen.
- Distance matrix calculations.

  

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
